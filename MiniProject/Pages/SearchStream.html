{% extends "/Pages/base.html" %}
{% block title %} Connex.us - Search Streams {% endblock title %}

{% block content %}
<head>
    <style>
     {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: Arial;
        }

        .header {
            text-align: center;
            padding: 22px;
        }

        /* Create two equal columns that floats next to each other */
        .column {
            float: left;
            width: 33%;
            padding: 10px;
        }


      #map {
          height: 100%;
          width: 100%;
      }

        #mapContainer {
            height: 640px;
            width: 960px;

            top:0;
            bottom: 0;
            left: 0;
            right: 0;

            margin: auto;
            margin-bottom: 50px;
        }


    input[type=text] {
        width: 130px;
        box-sizing: border-box;
        border: 2px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
        background-color: white;
        background-image: url('searchicon.png');
        background-position: 10px 10px;
        background-repeat: no-repeat;
        padding: 10px 10px 10px 10px;
        -webkit-transition: width 0.4s ease-in-out;
        transition: width 0.4s ease-in-out;
    }

    ul.ui-autocomplete {
    list-style: none;
    list-style-type: none;
    padding: 0px;
    margin: 0px;
    width: 100px;
    border-style: solid;
    border-width: 3px;
}

ul.ui-autocomplete li{
    background-color: white;
    padding:5px 8px;
    font-size:12px;
    outline:2px;
}

    #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }


</style>
    <!--Date Picker-->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!--Based this off from solution at https://codepen.io/2rod/pen/JtIki-->
    <script>
          $(function() {
        $( "#slider-range" ).slider({
          range: true,
          min: new Date("{{ prev_date }}").getTime() / 1000,
          max: new Date("{{ cur_date }}").getTime() / 1000,
          step: 86400,
          values: [ new Date("{{ prev_date }}").getTime() / 1000, new Date("{{ cur_date }}").getTime() / 1000 ],
          slide: function( event, ui ) {
            $( "#lower_bound" ).val( (new Date(ui.values[ 0 ] *1000).toDateString() ));
          $( "#upper_bound" ).val( (new Date(ui.values[ 1 ] *1000)).toDateString() );
          filterMarkers();
          }

        });
        $( "#lower_bound" ).val( (new Date($( "#slider-range" ).slider( "values", 0 )*1000).toDateString()));
        $( "#upper_bound" ).val( (new Date($( "#slider-range" ).slider( "values", 1 )*1000)).toDateString());
      });
      </script>
    <!--Date Picker-->

<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>
        $.getJSON('/AutoComplete', function (data) {
            $("#autocomplete").autocomplete({
                source: function(req, response) {
                    var results = $.ui.autocomplete.filter(data, req.term).sort();
                    response(results.slice(0,20));
                },
                minLength: 1
            });
        });
</script>
</head>
<body>



<form action="SearchStream" method="get">
  <div>
    <input id = "autocomplete" type="text" name="search" placeholder="Search.." align="left" hspace="10"> </br></br>
    <input type="submit" value="Search" align="left" hspace="10"/>

  </div>

  <div>
    <p style="padding: 10px 10px 10px 10px;">{{ num_found }} results found</br>Click on an image to view stream</p>
     {% for i, stream in streams_found %}
          <div class="row">
            <div class="image" style="padding: 10px 10px 10px 10px;">
              <a href="{{ stream.field('url').value }}">
                  {% if stream.field('cover_image').value  %}
                    <img src="{{ stream.field('cover_image').value }}"/>
                  {% else %}
                    <img src="http://placehold.it/150x150"/>
                  {% endif %}

              </a>
                <p style="padding: 10px 10px 10px 10px;">{{ stream.field("stream_name").value }}</p>

              <br>
            </div>

          </div>
    {% endfor %}
  </div>

</form>

		<div id="mapContainer">
			<div id="map"></div>

            <p>
              <input type="text" id="lower_bound" readonly style="border:0; color:#f6931f; font-weight:bold; width: 50%;">
                <input type="text" id="upper_bound" readonly style="border:0; color:#f6931f; font-weight:bold; float: right; width: 50%; text-align: right;" >
            </p>

            <div id="slider-range"></div>
		</div>



			<script>
                var map;
                var markers = [];
			  function initMap() {

				map = new google.maps.Map(document.getElementById('map'), {
				  zoom: 3,
				  center: {lat: 0, lng: 0}
				});

				var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

                    var infowindow =  new google.maps.InfoWindow({
                        content: ''
                    });

                  var pictures = {{ pictures|safe }}

                  for (var i = 0; i < pictures.length; i++)
                  {
                          markers.push(new google.maps.Marker({
                              position: new google.maps.LatLng(pictures[i].lat, pictures[i].lon),
                              map: map,
                              label: labels[i % labels.length],
                              date: pictures[i].date_uploaded
                          }));
                          bindInfoWindow(markers[markers.length - 1], map, infowindow, "<img src='" + pictures[i].image + "' height='100\' width='100'>");
                  }

                    var markerCluster = new MarkerClusterer(map, markers,
                        {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
			  }


			  function bindInfoWindow(marker, map, infowindow, html) {
                    google.maps.event.addListener(marker, 'mouseover', function() {
                        infowindow.setContent(html);
                        infowindow.open(map, marker);
                    });
                    google.maps.event.addListener(marker, 'mouseout', function() {
                        infowindow.close();
                    });
                }


                function filterMarkers()
                {
                    var lower_date = new Date($("#lower_bound").val());
                    var upper_date = new Date($("#upper_bound").val());

                    for (var i = 0; i < markers.length; i++)
                    {
                        var picture_date = new Date(markers[i].date);
                        if (picture_date >= lower_date && picture_date <= upper_date)
                        {
                            markers[i].setMap(map);
                        }
                        else
                        {
                            markers[i].setMap(null);
                        }
                    }
                }

			</script>
			<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
			</script>
			<script async defer
			src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDosJXIOAqz2lNj9K0vnGKnbOg1ZcapiIY&callback=initMap">
			</script>

<form action="AutoCompleteCreation" method="get">
  <div>
    <input type="submit" value="Rebuild Completion Index" align="center" hspace="10"/>

  </div>

</form>

</body>
{% endblock content %}
